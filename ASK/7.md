é€™å€‹éŒ¯èª¤æ˜¯å› ç‚ºç•¶è§£æ**æˆåŠŸ**æ™‚ï¼Œæ²’æœ‰è¿”å› `raw_output` æ¬„ä½ï¼Œä½†ä½ åœ¨è¼¸å‡ºè®Šæ•¸ä¸­å®šç¾©äº†å®ƒã€‚

## âœ… **è§£æ±ºæ–¹æ¡ˆï¼šç¢ºä¿æ‰€æœ‰æƒ…æ³éƒ½è¿”å›å®Œæ•´æ¬„ä½**

ä¿®æ”¹å¾Œçš„å®Œæ•´ä»£ç¢¼ï¼š

```python
def main(teacher_output: str) -> dict:
    """
    è§£æè€å¸«çš„è¼¸å‡ºï¼Œæå–çµæ§‹åŒ–æ•¸æ“š
    """
    import json
    import re
    
    try:
        # å˜—è©¦æ‰¾åˆ°JSONéƒ¨åˆ†ï¼ˆè™•ç†å¯èƒ½çš„é¡å¤–æ–‡å­—ï¼‰
        json_match = re.search(r'\{.*\}', teacher_output, re.DOTALL)
        
        if json_match:
            json_str = json_match.group()
            data = json.loads(json_str)
            
            # é©—è­‰å¿…è¦æ¬„ä½
            required_fields = ['problem_analysis', 'optimized_question', 
                             'extended_questions', 'knowledge_structure']
            
            for field in required_fields:
                if field not in data:
                    raise ValueError(f"Missing required field: {field}")
            
            # æ ¼å¼åŒ–è¼¸å‡ºä¾›å¾ŒçºŒä½¿ç”¨ï¼ˆæˆåŠŸæ™‚ä¹Ÿè¿”å›æ‰€æœ‰æ¬„ä½ï¼‰
            return {
                "status": "success",
                "parsed_data": data,
                "main_question": data['optimized_question']['refined_version'],
                "extended_questions_list": [
                    q['question'] for q in data['extended_questions']
                ],
                "formatted_output": format_for_display(data),
                "error_message": "",  # æˆåŠŸæ™‚ç‚ºç©ºå­—ä¸²
                "raw_output": teacher_output  # â† æ·»åŠ é€™å€‹
            }
        else:
            raise ValueError("No JSON found in output")
            
    except json.JSONDecodeError as e:
        return {
            "status": "error",
            "error_message": f"JSONè§£æå¤±æ•—: {str(e)}",
            "raw_output": teacher_output,
            "main_question": "",
            "extended_questions_list": [],
            "formatted_output": f"è§£æéŒ¯èª¤ï¼š{str(e)}",
            "parsed_data": {}
        }
    except Exception as e:
        return {
            "status": "error", 
            "error_message": str(e),
            "raw_output": teacher_output,
            "main_question": "",
            "extended_questions_list": [],
            "formatted_output": f"è™•ç†éŒ¯èª¤ï¼š{str(e)}",
            "parsed_data": {}
        }

def format_for_display(data: dict) -> str:
    """
    å°‡æ•¸æ“šæ ¼å¼åŒ–ç‚ºæ˜“è®€çš„æ–‡æœ¬
    """
    output = []
    
    # å•é¡Œåˆ†æ
    analysis = data['problem_analysis']
    output.append("ğŸ“Š **å•é¡Œåˆ†æ**")
    output.append(f"- æ ¸å¿ƒæ¦‚å¿µï¼š{analysis['core_concept']}")
    output.append(f"- è¤‡é›œåº¦ï¼š{analysis['complexity_level']}")
    output.append(f"- å­¸ç¿’æ„åœ–ï¼š{analysis['learner_intent']}\n")
    
    # å„ªåŒ–å¾Œçš„å•é¡Œ
    optimized = data['optimized_question']
    output.append("ğŸ¯ **å„ªåŒ–å¾Œçš„å•é¡Œ**")
    output.append(f"ä¸»è¦å•é¡Œï¼š{optimized['refined_version']}")
    output.append(f"èƒŒæ™¯èªªæ˜ï¼š{optimized['context']}")
    output.append(f"è¨è«–ç¯„åœï¼š{optimized['scope']}\n")
    
    # å»¶ä¼¸å•é¡Œ
    output.append("ğŸ” **å»¶ä¼¸æ¢è¨æ–¹å‘**")
    for i, q in enumerate(data['extended_questions'], 1):
        output.append(f"\n{i}. [{q['perspective']}]")
        output.append(f"   å•é¡Œï¼š{q['question']}")
        output.append(f"   åƒ¹å€¼ï¼š{q['learning_value']}")
    
    # çŸ¥è­˜çµæ§‹
    knowledge = data['knowledge_structure']
    output.append("\nğŸ“š **çŸ¥è­˜æ¶æ§‹**")
    output.append(f"- ä¸»è¦é ˜åŸŸï¼š{knowledge['primary_domain']}")
    output.append(f"- ç›¸é—œé ˜åŸŸï¼š{', '.join(knowledge['related_fields'])}")
    output.append(f"- å‰ç½®çŸ¥è­˜ï¼š{', '.join(knowledge['prerequisites'])}")
    output.append(f"- é€²éšä¸»é¡Œï¼š{', '.join(knowledge['advanced_topics'])}")
    
    return "\n".join(output)
```

---

## ğŸ”‘ **é—œéµä¿®æ”¹ï¼š**

åœ¨æˆåŠŸçš„ return ä¸­æ·»åŠ äº†ï¼š
```python
"error_message": "",  # æˆåŠŸæ™‚ç‚ºç©º
"raw_output": teacher_output  # ä¿ç•™åŸå§‹è¼¸å‡º
```

---

## ğŸ“‹ **å®Œæ•´çš„è¼¸å‡ºè®Šæ•¸é…ç½®ï¼ˆç¢ºèªé€™äº›éƒ½æœ‰å®šç¾©ï¼‰ï¼š**

```yaml
è¼¸å‡ºè®Šæ•¸ï¼š
1. status (String) - å¿…é ˆ
2. main_question (String) - å¿…é ˆ
3. formatted_output (String) - å¿…é ˆ
4. extended_questions_list (Array[String]) - å¿…é ˆ
5. parsed_data (Object) - å¿…é ˆ
6. error_message (String) - å¿…é ˆ
7. raw_output (String) - å¿…é ˆ
```

---

## ğŸ’¡ **å…©ç¨®è§£æ±ºæ–¹æ¡ˆï¼š**

### **æ–¹æ¡ˆ Aï¼šç¢ºä¿æ‰€æœ‰æ¬„ä½éƒ½æœ‰å€¼ï¼ˆæ¨è–¦ï¼‰**
å°±æ˜¯ä¸Šé¢çš„ä»£ç¢¼ï¼Œç„¡è«–æˆåŠŸæˆ–å¤±æ•—éƒ½è¿”å› 7 å€‹æ¬„ä½ã€‚

### **æ–¹æ¡ˆ Bï¼šåªå®šç¾©å¿…è¦çš„è¼¸å‡ºè®Šæ•¸**
å¦‚æœä½ ä¸éœ€è¦ `error_message` å’Œ `raw_output`ï¼Œå¯ä»¥ï¼š

1. **å¾è¼¸å‡ºè®Šæ•¸é…ç½®ä¸­åˆªé™¤å®ƒå€‘**
2. **ä½¿ç”¨ç°¡åŒ–ä»£ç¢¼ï¼š**

```python
def main(teacher_output: str) -> dict:
    import json
    import re
    
    try:
        json_match = re.search(r'\{.*\}', teacher_output, re.DOTALL)
        
        if json_match:
            json_str = json_match.group()
            data = json.loads(json_str)
            
            required_fields = ['problem_analysis', 'optimized_question', 
                             'extended_questions', 'knowledge_structure']
            
            for field in required_fields:
                if field not in data:
                    raise ValueError(f"Missing required field: {field}")
            
            # åªè¿”å›æ ¸å¿ƒæ¬„ä½
            return {
                "status": "success",
                "parsed_data": data,
                "main_question": data['optimized_question']['refined_version'],
                "extended_questions_list": [
                    q['question'] for q in data['extended_questions']
                ],
                "formatted_output": format_for_display(data)
            }
        else:
            raise ValueError("No JSON found")
            
    except Exception as e:
        # éŒ¯èª¤æ™‚ä¹Ÿåªè¿”å›æ ¸å¿ƒæ¬„ä½
        return {
            "status": "error",
            "parsed_data": {},
            "main_question": "",
            "extended_questions_list": [],
            "formatted_output": f"è™•ç†éŒ¯èª¤ï¼š{str(e)}\n\nåŸå§‹å…§å®¹ï¼š{teacher_output}"
        }

def format_for_display(data: dict) -> str:
    output = []
    
    analysis = data['problem_analysis']
    output.append("ğŸ“Š **å•é¡Œåˆ†æ**")
    output.append(f"- æ ¸å¿ƒæ¦‚å¿µï¼š{analysis['core_concept']}")
    output.append(f"- è¤‡é›œåº¦ï¼š{analysis['complexity_level']}")
    output.append(f"- å­¸ç¿’æ„åœ–ï¼š{analysis['learner_intent']}\n")
    
    optimized = data['optimized_question']
    output.append("ğŸ¯ **å„ªåŒ–å¾Œçš„å•é¡Œ**")
    output.append(f"ä¸»è¦å•é¡Œï¼š{optimized['refined_version']}")
    output.append(f"èƒŒæ™¯èªªæ˜ï¼š{optimized['context']}")
    output.append(f"è¨è«–ç¯„åœï¼š{optimized['scope']}\n")
    
    output.append("ğŸ” **å»¶ä¼¸æ¢è¨æ–¹å‘**")
    for i, q in enumerate(data['extended_questions'], 1):
        output.append(f"\n{i}. [{q['perspective']}]")
        output.append(f"   å•é¡Œï¼š{q['question']}")
        output.append(f"   åƒ¹å€¼ï¼š{q['learning_value']}")
    
    knowledge = data['knowledge_structure']
    output.append("\nğŸ“š **çŸ¥è­˜æ¶æ§‹**")
    output.append(f"- ä¸»è¦é ˜åŸŸï¼š{knowledge['primary_domain']}")
    output.append(f"- ç›¸é—œé ˜åŸŸï¼š{', '.join(knowledge['related_fields'])}")
    output.append(f"- å‰ç½®çŸ¥è­˜ï¼š{', '.join(knowledge['prerequisites'])}")
    output.append(f"- é€²éšä¸»é¡Œï¼š{', '.join(knowledge['advanced_topics'])}")
    
    return "\n".join(output)
```

æ­¤æ™‚è¼¸å‡ºè®Šæ•¸åªéœ€å®šç¾© 5 å€‹ï¼š
```yaml
1. status (String)
2. main_question (String)
3. formatted_output (String)
4. extended_questions_list (Array[String])
5. parsed_data (Object)
```

---

## ğŸ¯ **æˆ‘çš„å»ºè­°ï¼š**

**ä½¿ç”¨æ–¹æ¡ˆ Aï¼ˆå®Œæ•´ç‰ˆï¼‰** æ¯”è¼ƒå¥½ï¼Œå› ç‚ºï¼š
- âœ… èª¿è©¦æ™‚å¯ä»¥çœ‹åˆ°åŸå§‹è¼¸å‡º
- âœ… éŒ¯èª¤è¨Šæ¯æ›´æ¸…æ¥š
- âœ… æ›´å®¹æ˜“æ’æŸ¥å•é¡Œ

---

ç¾åœ¨è©¦è©¦çœ‹ï¼Œæ‡‰è©²å¯ä»¥æ­£å¸¸é‹è¡Œäº†ï¼å¦‚æœé‚„æœ‰å•é¡Œï¼Œå‘Šè¨´æˆ‘æ–°çš„éŒ¯èª¤è¨Šæ¯ã€‚
