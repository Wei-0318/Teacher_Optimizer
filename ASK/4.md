å¥½çš„ï¼è®“æˆ‘è©³ç´°èªªæ˜ Dify ä»£ç¢¼ç¯€é»çš„**è¼¸å‡ºè®Šæ•¸**è¨­å®šï¼š

## ğŸ“¤ **ä»£ç¢¼ç¯€é»è¼¸å‡ºè®Šæ•¸è¨­å®š**

### **åœ¨ Dify ä¸­ï¼Œä»£ç¢¼ç¯€é»çš„è¼¸å‡ºæœ‰å…©ç¨®æ–¹å¼ï¼š**

---

## **æ–¹å¼ä¸€ï¼šè‡ªå‹•è¼¸å‡ºï¼ˆæ¨è–¦ï¼‰**

Dify æœƒè‡ªå‹•å°‡ `return` çš„å­—å…¸è§£æç‚ºè¼¸å‡ºè®Šæ•¸ã€‚

### **ä½ çš„ä»£ç¢¼è¿”å›çš„çµæ§‹ï¼š**
```python
return {
    "status": "success",
    "parsed_data": {...},
    "main_question": "...",
    "extended_questions_list": [...],
    "formatted_output": "..."
}
```

### **åœ¨ Dify ä»‹é¢æ“ä½œï¼š**

1. **ä¸éœ€è¦æ‰‹å‹•æ·»åŠ è¼¸å‡ºè®Šæ•¸**
2. Dify æœƒè‡ªå‹•è­˜åˆ¥ return çš„å­—å…¸
3. å¾ŒçºŒç¯€é»å¯ä»¥ç›´æ¥å¼•ç”¨ï¼š
   ```
   {{Parse_JSON.status}}
   {{Parse_JSON.main_question}}
   {{Parse_JSON.formatted_output}}
   {{Parse_JSON.extended_questions_list}}
   ```

---

## **æ–¹å¼äºŒï¼šæ˜ç¢ºå®šç¾©è¼¸å‡ºè®Šæ•¸**

å¦‚æœéœ€è¦æ›´æ˜ç¢ºçš„å®šç¾©ï¼Œå¯ä»¥åœ¨ä»£ç¢¼ç¯€é»è¨­å®šï¼š

### **åœ¨å³å´é¢æ¿æ‰¾åˆ°ã€Œè¼¸å‡ºã€å€å¡Š**

é»æ“Šã€Œ+ æ·»åŠ è¼¸å‡ºè®Šæ•¸ã€ï¼Œé€å€‹æ·»åŠ ï¼š

```yaml
è¼¸å‡ºè®Šæ•¸ 1:
  è®Šæ•¸å: status
  é¡å‹: String
  
è¼¸å‡ºè®Šæ•¸ 2:
  è®Šæ•¸å: main_question
  é¡å‹: String
  
è¼¸å‡ºè®Šæ•¸ 3:
  è®Šæ•¸å: formatted_output
  é¡å‹: String
  
è¼¸å‡ºè®Šæ•¸ 4:
  è®Šæ•¸å: extended_questions_list
  é¡å‹: Array
  
è¼¸å‡ºè®Šæ•¸ 5:
  è®Šæ•¸å: parsed_data
  é¡å‹: Object

è¼¸å‡ºè®Šæ•¸ 6:
  è®Šæ•¸å: error_message
  é¡å‹: String

è¼¸å‡ºè®Šæ•¸ 7:
  è®Šæ•¸å: raw_output
  é¡å‹: String
```

---

## **å®Œæ•´çš„ä»£ç¢¼ç¯€é»é…ç½®ç¤ºæ„ï¼š**

```
â”Œâ”€ ä»£ç¢¼ç¯€é»: Parse_JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                              â”‚
â”‚ [è¼¸å…¥è®Šæ•¸]                                   â”‚
â”‚ â”œâ”€ teacher_output (String)                  â”‚
â”‚ â”‚  å¼•ç”¨: {{LLM-1.text}}                     â”‚
â”‚ â””â”€                                          â”‚
â”‚                                              â”‚
â”‚ [ä»£ç¢¼ç·¨è¼¯å™¨]                                 â”‚
â”‚ def main(teacher_output: str) -> dict:      â”‚
â”‚     ...                                      â”‚
â”‚     return {                                 â”‚
â”‚         "status": "success",                â”‚
â”‚         "main_question": "...",             â”‚
â”‚         "formatted_output": "...",          â”‚
â”‚         ...                                  â”‚
â”‚     }                                        â”‚
â”‚                                              â”‚
â”‚ [è¼¸å‡ºè®Šæ•¸] (Dify è‡ªå‹•è§£ææˆ–æ‰‹å‹•å®šç¾©)          â”‚
â”‚ â”œâ”€ status (String)                          â”‚
â”‚ â”œâ”€ main_question (String)                   â”‚
â”‚ â”œâ”€ formatted_output (String)                â”‚
â”‚ â”œâ”€ extended_questions_list (Array)          â”‚
â”‚ â”œâ”€ parsed_data (Object)                     â”‚
â”‚ â”œâ”€ error_message (String) - å¯é¸            â”‚
â”‚ â””â”€ raw_output (String) - å¯é¸               â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **åœ¨å¾ŒçºŒç¯€é»ä¸­å¼•ç”¨è¼¸å‡ºï¼š**

### **æ–¹æ³• Aï¼šç›´æ¥åœ¨æ–‡æœ¬ä¸­å¼•ç”¨**
```yaml
ç¯€é»é¡å‹: æ–‡æœ¬
å…§å®¹: |
  {{Parse_JSON.formatted_output}}
```

### **æ–¹æ³• Bï¼šåœ¨ LLM Prompt ä¸­å¼•ç”¨**
```yaml
ç¯€é»é¡å‹: LLM
Prompt: |
  è«‹å›ç­”é€™å€‹å•é¡Œï¼š
  {{Parse_JSON.main_question}}
  
  å»¶ä¼¸å•é¡Œï¼š
  {{Parse_JSON.extended_questions_list}}
```

### **æ–¹æ³• Cï¼šåœ¨æ¢ä»¶ç¯€é»ä¸­å¼•ç”¨**
```yaml
ç¯€é»é¡å‹: IF/ELSE
æ¢ä»¶: {{Parse_JSON.status}} == "success"
```

---

## **é©—è­‰è¼¸å‡ºæ˜¯å¦æ­£ç¢ºï¼š**

### **1. ä½¿ç”¨èª¿è©¦æ¨¡å¼**
- é‹è¡Œå·¥ä½œæµ
- é»æ“Šä»£ç¢¼ç¯€é»æŸ¥çœ‹åŸ·è¡Œçµæœ
- ç¢ºèªè¼¸å‡ºçµæ§‹

### **2. æ·»åŠ è‡¨æ™‚è¼¸å‡ºç¯€é»**
```yaml
ç¯€é»é¡å‹: æ–‡æœ¬
å…§å®¹: |
  ç‹€æ…‹: {{Parse_JSON.status}}
  ä¸»è¦å•é¡Œ: {{Parse_JSON.main_question}}
  æ ¼å¼åŒ–è¼¸å‡º:
  {{Parse_JSON.formatted_output}}
```

---

## **å¸¸è¦‹å•é¡Œè™•ç†ï¼š**

### **Q1: è¼¸å‡ºè®Šæ•¸é¡¯ç¤ºç‚ºç©ºï¼Ÿ**
**åŸå› ï¼š** return çš„ key åç¨±èˆ‡å¼•ç”¨ä¸ä¸€è‡´

**è§£æ±ºï¼š**
```python
# ç¢ºä¿ return çš„ key èˆ‡å¼•ç”¨çš„è®Šæ•¸åä¸€è‡´
return {
    "status": "success",  # å¼•ç”¨: {{ç¯€é»å.status}}
    "main_question": "..." # å¼•ç”¨: {{ç¯€é»å.main_question}}
}
```

### **Q2: é™£åˆ—é¡å‹å¦‚ä½•éæ­·ï¼Ÿ**
```jinja2
{% for question in Parse_JSON.extended_questions_list %}
  - {{question}}
{% endfor %}
```

### **Q3: ç‰©ä»¶é¡å‹å¦‚ä½•å­˜å–ï¼Ÿ**
```jinja2
{{Parse_JSON.parsed_data.problem_analysis.core_concept}}
```

---

## **æ¨è–¦çš„ç°¡åŒ–ç‰ˆæœ¬ï¼ˆå¦‚æœé‡åˆ°å•é¡Œï¼‰ï¼š**

å¦‚æœè¼¸å‡ºè¨­å®šæœ‰å•é¡Œï¼Œå¯ä»¥å…ˆç°¡åŒ–ä»£ç¢¼è¿”å›ï¼š

```python
def main(teacher_output: str) -> dict:
    import json
    import re
    
    try:
        json_match = re.search(r'\{.*\}', teacher_output, re.DOTALL)
        if json_match:
            data = json.loads(json_match.group())
            
            # ç°¡åŒ–è¼¸å‡ºï¼Œåªè¿”å›å¿…è¦çš„å­—æ®µ
            return {
                "status": "success",
                "main_question": data['optimized_question']['refined_version'],
                "formatted_output": str(data)  # å…ˆç°¡å–®è½‰å­—ä¸²
            }
    except:
        return {
            "status": "error",
            "main_question": "",
            "formatted_output": f"è§£æå¤±æ•—: {teacher_output}"
        }
```

é€™æ¨£åªæœ‰ä¸‰å€‹è¼¸å‡ºè®Šæ•¸ï¼Œæ›´å®¹æ˜“ç®¡ç†ã€‚

---

## **å®Œæ•´æ¸¬è©¦æµç¨‹ï¼š**

1. **è¨­å®šä»£ç¢¼ç¯€é»**ï¼ˆè²¼ä¸Šä»£ç¢¼ï¼‰
2. **é€£æ¥ LLM ç¯€é»è¼¸å‡ºåˆ°ä»£ç¢¼ç¯€é»è¼¸å…¥**
3. **æ·»åŠ ä¸€å€‹æ–‡æœ¬ç¯€é»æ¸¬è©¦è¼¸å‡º**
   ```
   æ¸¬è©¦è¼¸å‡º:
   {{Parse_JSON.status}}
   {{Parse_JSON.main_question}}
   ```
4. **é‹è¡Œä¸¦æŸ¥çœ‹çµæœ**
5. **ç¢ºèªç„¡èª¤å¾Œå†æ·»åŠ è¤‡é›œé‚è¼¯**

---

ä½ ç¾åœ¨èƒ½çœ‹åˆ°è¼¸å‡ºè®Šæ•¸çš„è¨­å®šå€å¡Šå—ï¼Ÿæˆ–è€…é‹è¡Œå¾Œæœ‰ä»€éº¼éŒ¯èª¤è¨Šæ¯å—ï¼Ÿå‘Šè¨´æˆ‘å…·é«”æƒ…æ³ï¼Œæˆ‘å¯ä»¥æ›´ç²¾ç¢ºåœ°å”åŠ©ä½ ï¼
