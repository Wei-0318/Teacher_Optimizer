app:
  description: ''
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: Learning-test
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.2.6@e2665624a156f52160927bceac9e169bd7e5ae6b936ae82575e14c90af390e6e
    version: null
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInLoop: false
        sourceType: start
        targetType: llm
      id: 1762786726374-source-1762883421824-target
      selected: false
      source: '1762786726374'
      sourceHandle: source
      target: '1762883421824'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1762883421824-source-1762936902390-target
      selected: false
      source: '1762883421824'
      sourceHandle: source
      target: '1762936902390'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: end
      id: 1762936902390-source-1762938291948-target
      source: '1762936902390'
      sourceHandle: source
      target: '1762938291948'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        selected: false
        title: é–‹å§‹
        type: start
        variables:
        - default: ''
          hint: ''
          label: è«‹è¼¸å…¥ä½ æƒ³äº†è§£çš„å•é¡Œæˆ–ä¸»é¡Œ
          max_length: 256
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: user_question
      height: 86
      id: '1762786726374'
      position:
        x: 80
        y: 282
      positionAbsolute:
        x: 80
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        context:
          enabled: true
          variable_selector:
          - '1762786726374'
          - user_question
        desc: ''
        model:
          completion_params:
            frequency_penalty: 0.3
            max_tokens: 2001
            temperature: 0.7
          mode: chat
          name: gpt-4
          provider: langgenius/openai/openai
        prompt_template:
        - id: bd87da3b-099a-4c15-b05e-ac7e4aec6ca4
          role: system
          text: 'ä½ æ˜¯ä¸€ä½è³‡æ·±çš„æ•™è‚²å°ˆå®¶ï¼Œå°ˆé–€å°‡ç°¡å–®çš„å•é¡Œè½‰åŒ–ç‚ºæœ‰æ·±åº¦çš„æ•™å­¸æ©Ÿæœƒã€‚ä½ çš„è§’è‰²æ˜¯ï¼š

            1. åˆ†æå•é¡Œçš„æ•™è‚²åƒ¹å€¼

            2. å„ªåŒ–å•é¡Œä½¿å…¶æ›´å…·é«”ã€æ›´æœ‰æ·±åº¦

            3. å¾å¤šå€‹è§’åº¦å»¶ä¼¸å•é¡Œ

            4. å»ºç«‹çŸ¥è­˜æ¶æ§‹


            å›æ‡‰å¿…é ˆæ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ã€‚'
        - id: 6cf7ccfb-ee3c-4597-ac99-7884d5d65190
          role: user
          text: "è«‹åˆ†æä¸¦å„ªåŒ–ä»¥ä¸‹å•é¡Œï¼š\n\nã€åŸå§‹å•é¡Œã€‘\n{{#1762786726374.user_question#}}\n\nã€åˆ†æèˆ‡å„ªåŒ–è¦æ±‚ã€‘\n\
            \nè«‹å®Œæˆä»¥ä¸‹ä»»å‹™ä¸¦ä»¥JSONæ ¼å¼è¼¸å‡ºï¼š\n\n1. **å•é¡Œè¨ºæ–·**\n   - è­˜åˆ¥å•é¡Œçš„æ ¸å¿ƒæ¦‚å¿µ\n   - åˆ¤æ–·å•é¡Œçš„è¤‡é›œåº¦ï¼ˆåˆç´š/ä¸­ç´š/é«˜ç´šï¼‰\n\
            \   - æ¨æ¸¬æå•è€…çš„æ„åœ–\n\n2. **å•é¡Œé‡æ§‹**\n   - å°‡å•é¡Œæ”¹å¯«å¾—æ›´ç²¾ç¢º\n   - æ·»åŠ å¿…è¦çš„èƒŒæ™¯è„ˆçµ¡\n   - æ˜ç¢ºç•Œå®šè¨è«–ç¯„åœ\n\
            \n3. **å¤šç¶­åº¦å»¶ä¼¸**ï¼ˆè‡³å°‘3å€‹ä¸åŒè§’åº¦ï¼‰\n   - ç†è«–åŸºç¤ï¼šç›¸é—œçš„åŸºæœ¬åŸç†æ˜¯ä»€éº¼ï¼Ÿ\n   - å¯¦éš›æ‡‰ç”¨ï¼šå¦‚ä½•åœ¨ç¾å¯¦ä¸­é‹ç”¨ï¼Ÿ\n\
            \   - æ¯”è¼ƒåˆ†æï¼šèˆ‡é¡ä¼¼æ¦‚å¿µæœ‰ä½•ç•°åŒï¼Ÿ\n   - æ‰¹åˆ¤æ€è€ƒï¼šæœ‰å“ªäº›é™åˆ¶æˆ–çˆ­è­°ï¼Ÿ\n   - æœªä¾†ç™¼å±•ï¼šæœªä¾†è¶¨å‹¢å¦‚ä½•ï¼Ÿ\n\n4. **çŸ¥è­˜åœ°åœ–**\n\
            \   - ä¸»è¦æ¶‰åŠçš„å­¸ç§‘é ˜åŸŸ\n   - éœ€è¦çš„å‰ç½®çŸ¥è­˜\n   - å¯ä»¥å»¶ä¼¸å­¸ç¿’çš„é€²éšä¸»é¡Œ\n\nã€è¼¸å‡ºJSONæ ¼å¼ã€‘\n{\n  \"\
            problem_analysis\": {\n    \"core_concept\": \"è­˜åˆ¥å‡ºçš„æ ¸å¿ƒæ¦‚å¿µ\",\n    \"complexity_level\"\
            : \"åˆç´š/ä¸­ç´š/é«˜ç´š\",\n    \"learner_intent\": \"å­¸ç¿’è€…å¯èƒ½çš„ç›®çš„\"\n  },\n  \"optimized_question\"\
            : {\n    \"refined_version\": \"å„ªåŒ–å¾Œæ›´ç²¾ç¢ºçš„å•é¡Œè¡¨è¿°\",\n    \"context\": \"è£œå……çš„èƒŒæ™¯è³‡è¨Š\"\
            ,\n    \"scope\": \"æ˜ç¢ºçš„è¨è«–ç¯„åœ\"\n  },\n  \"extended_questions\": [\n   \
            \ {\n      \"perspective\": \"ç†è«–åŸºç¤\",\n      \"question\": \"å…·é«”çš„å»¶ä¼¸å•é¡Œ\"\
            ,\n      \"learning_value\": \"é€™å€‹å•é¡Œçš„æ•™å­¸åƒ¹å€¼\"\n    },\n    {\n      \"perspective\"\
            : \"å¯¦éš›æ‡‰ç”¨\", \n      \"question\": \"å…·é«”çš„å»¶ä¼¸å•é¡Œ\",\n      \"learning_value\"\
            : \"é€™å€‹å•é¡Œçš„æ•™å­¸åƒ¹å€¼\"\n    },\n    {\n      \"perspective\": \"æ¯”è¼ƒåˆ†æ\",\n   \
            \   \"question\": \"å…·é«”çš„å»¶ä¼¸å•é¡Œ\", \n      \"learning_value\": \"é€™å€‹å•é¡Œçš„æ•™å­¸åƒ¹å€¼\"\
            \n    }\n  ],\n  \"knowledge_structure\": {\n    \"primary_domain\": \"\
            ä¸»è¦çŸ¥è­˜é ˜åŸŸ\",\n    \"related_fields\": [\"ç›¸é—œé ˜åŸŸ1\", \"ç›¸é—œé ˜åŸŸ2\"],\n    \"prerequisites\"\
            : [\"å‰ç½®çŸ¥è­˜1\", \"å‰ç½®çŸ¥è­˜2\"],\n    \"advanced_topics\": [\"é€²éšä¸»é¡Œ1\", \"é€²éšä¸»é¡Œ2\"\
            ]\n  }\n}"
        selected: false
        structured_output_enabled: false
        title: å¸«Q01
        type: llm
        vision:
          enabled: false
      height: 86
      id: '1762883421824'
      position:
        x: 363
        y: 282
      positionAbsolute:
        x: 363
        y: 282
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        code: "def main(teacher_output: str) -> dict:\n    \"\"\"\n    è§£æè€å¸«çš„è¼¸å‡ºï¼Œæå–çµæ§‹åŒ–æ•¸æ“š\n\
          \    \"\"\"\n    import json\n    import re\n    \n    try:\n        # å˜—è©¦æ‰¾åˆ°JSONéƒ¨åˆ†ï¼ˆè™•ç†å¯èƒ½çš„é¡å¤–æ–‡å­—ï¼‰\n\
          \        json_match = re.search(r'\\{.*\\}', teacher_output, re.DOTALL)\n\
          \        \n        if json_match:\n            json_str = json_match.group()\n\
          \            data = json.loads(json_str)\n            \n            # é©—è­‰å¿…è¦æ¬„ä½\n\
          \            required_fields = ['problem_analysis', 'optimized_question',\
          \ \n                             'extended_questions', 'knowledge_structure']\n\
          \            \n            for field in required_fields:\n             \
          \   if field not in data:\n                    raise ValueError(f\"Missing\
          \ required field: {field}\")\n            \n            # æ ¼å¼åŒ–è¼¸å‡ºä¾›å¾ŒçºŒä½¿ç”¨ï¼ˆæˆåŠŸæ™‚ä¹Ÿè¿”å›æ‰€æœ‰æ¬„ä½ï¼‰\n\
          \            return {\n                \"status\": \"success\",\n      \
          \          \"parsed_data\": data,\n                \"main_question\": data['optimized_question']['refined_version'],\n\
          \                \"extended_questions_list\": [\n                    q['question']\
          \ for q in data['extended_questions']\n                ],\n            \
          \    \"formatted_output\": format_for_display(data),\n                \"\
          error_message\": \"\",  # æˆåŠŸæ™‚ç‚ºç©ºå­—ä¸²\n                \"raw_output\": teacher_output\
          \  # â† æ·»åŠ é€™å€‹\n            }\n        else:\n            raise ValueError(\"\
          No JSON found in output\")\n            \n    except json.JSONDecodeError\
          \ as e:\n        return {\n            \"status\": \"error\",\n        \
          \    \"error_message\": f\"JSONè§£æå¤±æ•—: {str(e)}\",\n            \"raw_output\"\
          : teacher_output,\n            \"main_question\": \"\",\n            \"\
          extended_questions_list\": [],\n            \"formatted_output\": f\"è§£æéŒ¯èª¤ï¼š{str(e)}\"\
          ,\n            \"parsed_data\": {}\n        }\n    except Exception as e:\n\
          \        return {\n            \"status\": \"error\", \n            \"error_message\"\
          : str(e),\n            \"raw_output\": teacher_output,\n            \"main_question\"\
          : \"\",\n            \"extended_questions_list\": [],\n            \"formatted_output\"\
          : f\"è™•ç†éŒ¯èª¤ï¼š{str(e)}\",\n            \"parsed_data\": {}\n        }\n\ndef\
          \ format_for_display(data: dict) -> str:\n    \"\"\"\n    å°‡æ•¸æ“šæ ¼å¼åŒ–ç‚ºæ˜“è®€çš„æ–‡æœ¬\n\
          \    \"\"\"\n    output = []\n    \n    # å•é¡Œåˆ†æ\n    analysis = data['problem_analysis']\n\
          \    output.append(\"\U0001F4CA **å•é¡Œåˆ†æ**\")\n    output.append(f\"- æ ¸å¿ƒæ¦‚å¿µï¼š{analysis['core_concept']}\"\
          )\n    output.append(f\"- è¤‡é›œåº¦ï¼š{analysis['complexity_level']}\")\n    output.append(f\"\
          - å­¸ç¿’æ„åœ–ï¼š{analysis['learner_intent']}\\n\")\n    \n    # å„ªåŒ–å¾Œçš„å•é¡Œ\n    optimized\
          \ = data['optimized_question']\n    output.append(\"\U0001F3AF **å„ªåŒ–å¾Œçš„å•é¡Œ**\"\
          )\n    output.append(f\"ä¸»è¦å•é¡Œï¼š{optimized['refined_version']}\")\n    output.append(f\"\
          èƒŒæ™¯èªªæ˜ï¼š{optimized['context']}\")\n    output.append(f\"è¨è«–ç¯„åœï¼š{optimized['scope']}\\\
          n\")\n    \n    # å»¶ä¼¸å•é¡Œ\n    output.append(\"\U0001F50D **å»¶ä¼¸æ¢è¨æ–¹å‘**\")\n \
          \   for i, q in enumerate(data['extended_questions'], 1):\n        output.append(f\"\
          \\n{i}. [{q['perspective']}]\")\n        output.append(f\"   å•é¡Œï¼š{q['question']}\"\
          )\n        output.append(f\"   åƒ¹å€¼ï¼š{q['learning_value']}\")\n    \n    #\
          \ çŸ¥è­˜çµæ§‹\n    knowledge = data['knowledge_structure']\n    output.append(\"\
          \\n\U0001F4DA **çŸ¥è­˜æ¶æ§‹**\")\n    output.append(f\"- ä¸»è¦é ˜åŸŸï¼š{knowledge['primary_domain']}\"\
          )\n    output.append(f\"- ç›¸é—œé ˜åŸŸï¼š{', '.join(knowledge['related_fields'])}\"\
          )\n    output.append(f\"- å‰ç½®çŸ¥è­˜ï¼š{', '.join(knowledge['prerequisites'])}\"\
          )\n    output.append(f\"- é€²éšä¸»é¡Œï¼š{', '.join(knowledge['advanced_topics'])}\"\
          )\n    \n    return \"\\n\".join(output)"
        code_language: python3
        outputs:
          error_message:
            children: null
            type: string
          extended_questions_list:
            children: null
            type: array[string]
          formatted_output:
            children: null
            type: string
          main_question:
            children: null
            type: string
          parsed_data:
            children: null
            type: object
          raw_output:
            children: null
            type: string
          status:
            children: null
            type: string
        selected: false
        title: ä»£ç¢¼åŸ·è¡Œ
        type: code
        variables:
        - value_selector:
          - '1762883421824'
          - text
          value_type: string
          variable: teacher_output
      height: 50
      id: '1762936902390'
      position:
        x: 665.7796087070392
        y: 282
      positionAbsolute:
        x: 665.7796087070392
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        outputs:
        - value_selector:
          - '1762936902390'
          - formatted_output
          value_type: string
          variable: formatted_output
        selected: false
        title: å•é¡Œåˆ†æçµæœ
        type: end
      height: 87
      id: '1762938291948'
      position:
        x: 975.6437028024095
        y: 282
      positionAbsolute:
        x: 975.6437028024095
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    viewport:
      x: -44.66591941731116
      y: -83.90110045148504
      zoom: 0.8408964261104206
  rag_pipeline_variables: []
